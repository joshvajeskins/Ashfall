# Prompt 7: End-to-End Testing & Bug Fixes

## Goal
Test the complete game flow from wallet connection to dungeon completion and fix any issues found.

## Pre-Check: Review ALL Issues
Before starting, check ALL issue docs:
- `docs/issues/move/README.md`
- `docs/issues/ui/README.md`
- `docs/issues/movement/README.md`
- `docs/issues/indexer/README.md`
- `docs/issues/tooling/README.md`

## Prerequisites
- Backend server running (`cd backend && npm run dev`)
- Frontend running (`cd frontend && npm run dev`)
- Contracts deployed to Movement testnet
- Server wallet funded and authorized

## Test Flows

### Flow 1: New Player Onboarding
```
1. Open app (http://localhost:3000)
2. Click "Connect Wallet"
3. Complete Privy authentication
4. Verify wallet address shows in header
5. See "Create Character" prompt (no existing character)
```

**Expected:** Smooth wallet connection, no errors

### Flow 2: Character Creation
```
1. Click "Create Character"
2. Select "Warrior" class
3. Review starting stats
4. Click "Create"
5. Wait for transaction confirmation
6. Verify character appears in UI
```

**Expected:** Transaction succeeds, character shows correct stats

### Flow 3: Stash Initialization
```
1. Click "Initialize Stash" (if shown)
2. Sign transaction
3. Verify stash panel shows (0/50)
```

**Expected:** Stash created on-chain

### Flow 4: Enter Dungeon
```
1. Click "Enter Dungeon"
2. Sign enter_dungeon transaction
3. Verify game scene loads
4. Check floor indicator shows "Floor 1/5"
5. Verify minimap renders
```

**Expected:** Dungeon loads, player can move

### Flow 5: Combat
```
1. Move player (WASD or arrows) toward enemy
2. Collide with enemy to start combat
3. Click "Attack" button
4. Verify damage numbers appear
5. Continue until enemy dies
6. Verify XP earned message
7. Check if loot drops
```

**Expected:** Combat flows smoothly, loot appears

### Flow 6: Floor Progression
```
1. Clear all enemies in room
2. Move through door to next room
3. Clear enough rooms to find exit
4. Use exit to advance floor
5. Repeat until Floor 5
```

**Expected:** Floor counter increments, enemies get harder

### Flow 7: Boss Fight
```
1. On Floor 5, find boss room
2. Engage boss (larger enemy)
3. Fight boss (more HP, higher damage)
4. Defeat boss
5. Verify boss loot (5% legendary chance)
```

**Expected:** Boss is challenging, rare drops possible

### Flow 8: Victory & Claim
```
1. After boss defeat, victory screen appears
2. See stats (floors, kills, time)
3. See loot list
4. Wait for "Claiming..." to complete
5. Click "Return to Town"
6. Verify stash shows new items
```

**Expected:** Loot transfers to stash on-chain

### Flow 9: Death Flow
```
1. Start new dungeon run
2. Get hit by enemies until HP = 0
3. Death screen appears
4. Wait for "Processing on chain..."
5. Click "Continue"
6. Verify character marked dead
7. Verify equipped items burned
8. Verify stash items preserved
```

**Expected:** Items burned, stash safe, can create new character

## Bug Fix Checklist

### Common Issues to Check:

- [ ] Wallet connection persists on page refresh
- [ ] Transactions don't timeout
- [ ] Error messages are user-friendly
- [ ] Loading states show properly
- [ ] No React hydration errors
- [ ] Mobile viewport works
- [ ] Keyboard controls work
- [ ] ESC exits dungeon properly
- [ ] Item tooltips don't overflow screen
- [ ] Stash panel scrolls if full

### Chain Issues:

- [ ] Transaction errors handled gracefully
- [ ] Retry logic for failed transactions
- [ ] Correct gas estimation
- [ ] Server authorization working

### Game Issues:

- [ ] Enemies spawn correctly
- [ ] Doors work in all directions
- [ ] Minimap updates
- [ ] Health bar accurate
- [ ] Combat math correct
- [ ] Flee chance works

## Documenting Issues

For any bug found, use `/document-learning` to add to issue docs:

```
/document-learning

Category: ui
Title: React hydration mismatch on wallet state
Problem: SSR renders "Connect" but client has cached wallet
Root cause: localStorage not available during SSR
Solution: Use useEffect for wallet state hydration
Prevention: Always wrap browser APIs in useEffect
```

## Acceptance Criteria
- [ ] All 9 flows complete without errors
- [ ] No console errors during normal gameplay
- [ ] All found bugs documented in `docs/issues/`
- [ ] Critical bugs fixed
- [ ] Game is playable end-to-end

## Next Prompt
Prompt 8 will prepare for production deployment.
